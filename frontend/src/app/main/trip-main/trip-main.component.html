<div class="flex h-screen">
    <!-- Scrollable Trip Details on the Left -->
    <div class="overflow-auto h-full sm:w-2/3 lg:w-1/2 xl:w-1/3">
        <app-navbar></app-navbar>
        <ng-container *ngIf="isLoading$ | async; else tripDetails">
            Loading...
        </ng-container>
        <ng-template #tripDetails>
            <div *ngIf="currentTrip$ | async as trip; else noDetails" class="p-1">
                <img *ngIf="trip.image" [src]="trip.image" alt="Trip Image" class="w-full h-40 object-cover rounded-md">
                <div class="text-5xl">Trip to {{ trip.country }}</div>

                <div class="flex justify-between mt-4">
                    <h2 class="text-md font-light text-gray-800 mb-4">Trip Buddies</h2>
                    <button (click)="openDialog()" class="rounded bg-sky-100 hover:bg-sky-200 h-5">+Trip Mate</button>
                </div>
                <div class="flex flex-wrap justify-center items-center">
                    <div *ngFor="let user of tripMates$ | async" class="relative w-32 h-25 m-2 bg-blue-100 rounded-lg shadow">
                      <div class="flex flex-col justify-center items-center p-2">
                        @if (trip.ownerId == user.userId) {
                            <div class="text-gray-800 text-sm font-thin">{{ user.username }} (owner)</div>
                        } @else {
                            <div class="text-gray-800 text-sm font-thin">{{ user.username }}</div>
                        }
                        <div class="text-gray-800 text-sm font-normal">{{ user.firstName| titlecase }} {{ user.lastName | titlecase}}</div>
                        <div class="text-gray-600 text-xs">{{ user.email }}</div>
                      </div>
                      <ng-container *ngIf="currentUser$ | async as currentUser">
                        <ng-container *ngIf="currentUser.userId === trip.ownerId && user.userId != trip.ownerId">
                            <button class="absolute top-0 right-0 m-0 text-red-500 hover:text-red-700 transition-colors opacity-0 hover:opacity-100" (click)="deleteTripMate(user.userId)">
                              <mat-icon>delete_outline</mat-icon>
                            </button>
                        </ng-container>
                      </ng-container>
                      
                    </div>
                  </div>
                  
                  
                  
                <app-flight [flights]="trip.flightDetails" class="p-1"></app-flight>
                <app-lodging [lodgings]="trip.lodgings" class="p-1"></app-lodging>
                <app-itinerary [days]="trip.itinerary.days" class="p-1"></app-itinerary>
            </div>
        </ng-template>
    </div>

    <!-- Fixed Map on the Right -->
    <div class="h-full sm:w-1/3 lg:w-1/2 xl:w-2/3" *ngIf="currentTrip$ | async as trip; else noDetails">
        <app-map
            [lodgings]="trip.lodgings"
            [itineraryDays]="trip.itinerary.days"
            class="h-full">
        </app-map>
    </div>
</div>

<ng-template #noDetails>
    No details
</ng-template>